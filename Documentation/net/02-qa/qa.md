# 网络相关问答

## Linux 网卡是如何工作的

网卡设备是通过网络接口卡(NIC)来实现的。网卡是计算机连接到网络的物理接口，它负责接收和发送数据包。

网卡设备的工作分为以下几个主要步骤：
1. 设备驱动程序加载：当计算机启动时候，操作系统会加载与网卡设备对应的驱动程序。这个驱动程序负责与硬件进行通信，并将设备表示为一个字符设备文件，例如：`/dev/eth0`
2. 网络配置：在设备驱动程序加载后，可以通过网络配置工具（如：ifconfig 或 ip 命令）对网卡进行配置。这包括设置 ip地址、子网掩码、网关等参数。
3. 数据包接收：当计算机接收到一个数据包时候，网卡设备会将数据包传输到内存中的接收缓存区。网卡设备会通过中断或者直接内存访问（DMA）方式将数据包复制到内存中。
4. 数据包处理：一旦数据包被复制到内存中，操作系统的网络协议栈将对其进行处理。这包括根据协议（如：TCP/IP）解析包头、检查校验和、进行路由选择等操作。根据目标IP地址，操作系统会决定将数据报传递给哪个进程或应用程序。
5. 数据报发送：当应用程序发送一个数据包时，操作系统会将数据包传递给网卡设备。网卡设备将数据包复制到发送缓存区，并通过DMA方式将数据包发送到网络中。
6. 中断处理：网卡设备在接收或发送数据包完成后会触发一个中断，通知操作系统有数据包需要处理。操作系统将调用相应的中断处理程序来处理这些中断。

## DPDK 是如何应用于网卡的

DPDK 是一个开源软件开发套件，旨在加速数据平面应用程序的开发和执行。它主要用于在高性能网络应用中利用网络接口卡（NIC）的硬件功能。

DPDK 通过绕过操作系统内核，在用户空间直接访问网卡硬件，从而降低了数据报处理的延迟，并提高了数据报处理的吞吐量。

下面是DPDK应用于网卡的一般工作流程：
1. 初始化：首先，应用程序需要初始化DPDK库，包括配置内存、初始化设备、创建处理线程等。这通常在应用程序启动时候完成。
2. 网卡绑定：应用程序需要将网卡绑定到DPDK驱动程序，以便DPDK可以直接访问当卡硬件。这通常通过将网卡驱动程序替换为DPDK提供的驱动程序来实现。
3. 数据包接收：应用程序使用 DPDK 提供的接口来接收网卡队列中的数据包，并将它们存储在应用程序指定的内存缓存区中
4. 数据包处理：一旦数据报被接收到应用程序的内存缓存区中，应用程序可以对数据包进行处理。这包括解析数据包头部、执行网络协议处理、进行数据包过滤、执行数据包转发等操作。由于 DPDK 在用户空间执行，避免了操作系统内核的开销，从而提高了数据报处理的性能。
5. 数据包发送：应用程序使用 DPDK 提供的接口将处理后的数据包发送到网卡发送队列。DPDK将数据包复制到网卡的发送缓存区，并通过DMA方式发送到网络中。
6. 释放资源：应用程序在完成数据包处理后，需要进行资源的清理和释放，包括释放内存、关闭设备等。

## 网络相关设备

1. 网卡（NIC）：将计算机连接到网络的设备。它实现计算机数据包 与 网络数据 转换。                             —— 物理层
2. 交换机（Switch）：将多个设备连接到一个网络上的设备，它根据MAC地址将数据包转发到相应的设备。              —— 数据链路层
3. 路由器（Router）：路由器是一种将多个网络连接到一起的设备，它根据IP地址将数据包转发到相应的网络。         —— 网络层
4. 网关（Gateway）：网关是一种将局域网络连接到广域网络（WAN）或互联网的设备。                               —— 网络层
5. Wi-Fi接入点（AP）：Wi-Fi接入点是一种将无线网络连接到局域网络的设备。                                     —— 数据链路层
6. 网络桥（Bridge）：网络桥是一种将两个或多个网络连接到一起的设备，它将数据包转发到相应的网络。             —— 数据链路层
7. 网络集线器（Hub）：是一种将多个设备连接到一个网络上的设备，它将数据包广播到所有连接到它的设备。          —— 物理层
8. 网络防火墙（Firewall）：是一种监控和控制进出网络的设备，它根据预先设定的安全规则来允许或拒绝网络流量。   —— 网络层
9. VPN服务器（VPN Server）：是一种将数据包加密并将其发送到互联网的设备，以便在互联网上进行安全通信。        —— 网络层
10. 光猫（Modem）：用于让计算机连接到互联网。                                                               —— 物理层
11. 代理服务器（Proxy Server）：                                                                            —— 应用层

> DPDK 工作在 OSI 的数据链路层

## 计算机接入互联网的必要设备

1. 网络接口卡（NIC）：允许计算机连接到网络的设备。有线 或 无线 NIC。
2. 路由器：这个设备将流量指向计算机和互联网之间。它连接到你的互联网服务提供商（ISP），并提供了一个网络门户，让你的计算机访问互联网。
3. 光猫：这个设备将计算机连接到你的互联网服务提供商（ISP）。它将数据从你的计算机转换成可以在互联网上传输的格式，并将互联网上的数据转换回来，以便计算机可以访问互联网。
4. 交换机：这个设备将多个设备在同一个局域网中连接起来。它将流量寄给正确的目的地，以确保数据能够正确的在设备之间传输。
5. 无线接入点（AP）：如果你有一个无线网络，你需要一个无线AP来连接你的计算机到互联网。无线AP将无线信号发送到你的计算机，以便你的计算机可以无线访问互联网。
6. Ethernet电缆：这个电缆将你的计算机连接到路由器或交换机，提供有限连接到网络。

网卡 --> 路由器（内置网络管理，即网关的功能、内置防火墙、VPN、访问控制列表ACL等） -->  光猫（连接到ISP）

### 光猫

光猫用于将光前接入网络。光猫的作用是将光纤信号转换为电信号，以便连接到用户的路由器或计算机。

光猫通常由网络服务提供商（ISP）提供。

并不是所有的网络中都需要光猫。在使用其它类型的网络连接（如：电缆、DSL等）无须使用光猫。

### 光猫和电缆调制解调器区别

#### 光猫（ONT）工作原理

光猫是用于光纤接入网络的设备。它的主要功能是将光纤传输的光信号转换为电信号，以便连接到用户的路由器或计算机，工作过程如下：
- 光纤信号到达光猫，经过光电转换器将光信号转换为电信号
- 转换后的电信号通过以太网端口或其它接口传输给用户的设备，例如：路由器。
- 用户设备接收到电信号后，可以通过路由器进行网络通信，连接到互联网。

#### 电缆调制解调器（Cable Modem）工作原理

电缆调制解调器是用于有线电视网络（Cable Internet）的设备。它的主要功能是将有限电视信号中的互联网数据解调，并将用户的数据传输回网络提供商。工作过程如下：
- 有线电视信号中包含了互联网数据，电缆调制解调器通过电缆线接收这个信号。
- 调制解调器将有线电视信号解调，提取出互联网数据
- 提取出的互联网数据通过以太网端口或其它接口传输给用户的设备，例如：路由器。
- 用户设备接收到互联网数据后，可以通过路由器进行网络通信，连接到互联网

#### 光猫和有限网络区别

- 光猫用于光纤接入网络，而电缆调制解调器主要用于有线电视网络
- 光猫将光纤信号转为电信号，而电缆调制解调器将有线电视信号调制为互联网数据
- 光猫通常由光纤网络服务提供商提供，而电缆调制解调器通常由有线电视网络服务提供商提供
- 光猫连接到用户设备的方式通常是通过以太网，而电缆调制解调器可以通过同样的方式或者通过电缆线连接

### 调制与解调的工作原理

调制和解调是将信号转换为适合传输或适合处理的形式的过程。

调制将数字或模拟信号转换为调试信号，解调则将调制信号还原为原始信号。

以下是调制和解调的基本工作原理：
- 数字调制：在数字调制中，将数字信号转换为模拟信号的形式来传输。常见的数字调制方法包括：
    - Amplitude Shift Keying（ASK）：使用不同的幅度表示数字信号的不同值
    - Frequency Shift Keying（FSK）：使用不同的频率来表示数字信号的不同值
    - Phase Shift Keying（PSK）：使用不同的相位来表示数字信号的不同值
- 模拟调制：在模拟调制中，将模拟信号转换为调制信号进行传输。常见的模拟调制方法包括：
    - Amplitude Modulation（AM）：将模拟信号的幅度变化与调制信号进行乘积，得到调制后的信号
    - Frequency Modulation（FM）：将模拟信号的频率变化与调制信号进行加减，得到调制后的信号。
    - Phase Modulation（PM）：将模拟信号的相位变化与调制信号进行加减，得到调制后的信号。

解调的工作原理：
- 数字解调：在数字解调中，将调制信号转换回数字信号的形式。解调过程通常与调制过程相反，使用相应的解调方法，如 ASK 解调器、FSK解调器或 PSK 解调器。
- 模拟解调：在模拟解调中，将模拟信号转换回模拟信号的形式。解调过程通常与调制过程相反，使用相应的解调方法，如AM解调器、FM解调器、PM解调器

调制和解调的目的是在信号传输过程中保持信号的完整性和准确性。调制将信号转换为合适传输的形式，解调将信号从调制形式还原为原始形式，以便接收方能正确理解和处理信号。这些过程在各种通信系统和传输介质中都得到广泛应用。

## 什么情况下要设置网关

网关是连接不同网络的设备，它充当了数据包在不同网络之间的中转站。

1. 访问其它网络：如果主机需要与其它网络通信，例如访问互联网或连接到另一个局域网，则需要设置网关。主机将发送到目标网络的数据包通过网关进行转发
2. 子网划分：如果网络被划分为多个子网，主机需要设置所属子网的网关。当主机需要与其它子网通信时候，数据包将通过网关进行中转。

## 发送数据时，网关如何工作

在数据发送时候，主机会通过查找其它本地路由表确定数据包的吓一跳目的地。如果目标地址不在同一子网内，主机会将数据包发送到预先配置的默认网关，也就是网关地址。

当数据包到达网关时候，网关会检查其路由表，确定下一跳的目标地址，并将数据包转发到正确的目标网络。

网关负责在不同网络之间进行转发和路由选择，确保数据包能够正确到达目标。

## 网关和路由器的区别

功能：网关是用于连接不同网络的设备，它充当了数据包在不同网络之间的中转站。它接收来自源主机的数据包并将其转发到目标网络。网关通常是一个网络中的特定设备，如交换机或路由器。而路由器是一种网络设备，用于在不同网络之间转发数据包。它根据网络层的信息（如：IP地址）来选择最佳路径，将数据包从源网络传递到目标网络。

覆盖范围：网关可以是一个单独的设备，也可以是网络中的一个节点。它通常用于将不同的局域网或广域网连接起来。而路由器是一种独立的网络设备，用于连接不同的网络，并帮助数据包在这些网络之间传输。

动作：网关的主要功能是转发数据包，使其从源主机传递到目标网络。它还可以执行其它功能，如网络地址转换（NAT）等。而路由器主要负责根据路由表中的信息选择最佳路径将数据包转发到目标网络。

位置：网关可以是网络中的任何设备，例如：交换机或路由器的接口。它通常是在网络的边界上，连接到不同网络的接口。而路由器通常是一个独立的设备，安装在网络中的特定位置，以便有效地转发数据包。

## 网路接口有哪些

1. 以太网接口（Ethernet Interface）：以太网接口是最常见和广泛使用的网络接口类型。它使用以太网协议进行数据通信，通过物理以太网连接（如：网线）连接到网络。
2. 无线局域网接口（Wireless LAN Interface）：无线局域网接口是通过无线技术（如：Wi-Fi）连接到局域网的接口。它使用无线协议进行数据通信，如：802.11系列标准
3. 虚拟接口（Virtual Interface）：虚拟接口是在操作系统中创建的逻辑接口，用于模拟一个额外的网络接口。它可以用于各种目的，如：网络隔离、网络虚拟化、VPN等。
4. 虚拟局域网接口（Virtual LAN Interface）：虚拟局域网接口是在物理接口上创建的逻辑接口，用于实现虚拟局域网（VLAN）功能。它允许将单个物理接口划分为多个逻辑字接口。每个子接口可以属于不同的VLAN。
5. 网络隧道接口（Network Tunnel Interface）：网络隧道接口用于在不同的网络之间创建逻辑通道，以便在隧道中传输数据。它可以用于连接远程网络、实现虚拟专用网络（VPN）、隧道协议（如：IPsec、GRE等）等
6. 回环接口（Loopback Interface）：回环接口是一种特殊的接口，用于在本地主机上进行网络测试和通信。它允许主机通过发送和接收数据来测试网络协议栈的功能，而无须实际的物理网络连接。

除了上述常见的网络接口类型，还有其它特定用途的网络接口，如调试接口、串口接口等，这些接口根据具体应用和需求而有所不同。

1. 以太网协议
2. 无线局域网协议（如：802.11a/b/g/n/ac/ax）
3. 不涉及物理层协议
4. 在物理接口上创建的逻辑接口，用于实现虚拟局域网功能
5. 网络隧道协议，将数据封装在一个协议的包装中传输。常见的隧道协议包括IPSec、GRE、L2TP等。隧道接口通常不直接使用以太网协议进行通信。
6. 通常使用主机上的协议进行数据交换，不涉及物理网络连接。

## 桥接接口功能

桥接是一种网络接口，用于将多个网络接口连接到一起，从而实现网络中的桥接功能。桥接功能提供了以下几个主要用途：
1. 实现网络分段和隔离：通过桥接接口，可以将网络分割为多个逻辑段，每个逻辑段可以有不同的网络配置和安全策略。这样可以实现不同的子网之间的隔离，增加网络的安全性和管理灵活性。
2. 扩展网络范围：通过桥接接口，可以将多个物理接口或虚拟接口桥接在一起，扩展网络的范围和覆盖范围。这样可以实现更大规模的网络连接，满足多个子网之间的通信需求。
3. 实现虚拟化网络：桥接接口可以用于实现网络虚拟化，创建虚拟局域网(VLAN)和虚拟交换机。通过桥接接口，可以将不同的虚拟机或容器连接到同一桥接接口上，使其能够在同一网络中进行通信。
4. 提供高可用性和冗余：桥接接口和网络冗余技术（如：STP、RSTP等）结合使用，提供网络的冗余和高可用性。当一个接口或链路发生故障时候，桥接接口可以自动切换到备用链路，确保网络的可靠性和连通性。
5. 监听和分析网络流量：通过桥接接口，可以在网络中监听和捕获流经该接口的网络流量。这对于故障排除、性能分析、安全审计非常有用。

> 桥接接口 可以 相当于 交换机
